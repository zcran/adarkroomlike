# adarkroomlike

git add --all; git commit -m "normal update"; git push -u origin main



组织结构：
adarkroom-bevy/
├── Cargo.toml               # 项目依赖和元数据
├── src/                     # 源代码目录
│   ├── main.rs              # 程序入口点
│   ├── app_state.rs         # 应用状态定义
│   ├── resources/           # 全局资源
│   │   ├── game_state.rs    # 游戏状态
│   │   ├── world_config.rs  # 世界配置
│   │   └── audio_manager.rs # 音频管理器
│   ├── components/          # 游戏组件
│   │   ├── player.rs        # 玩家组件
│   │   ├── tile.rs          # 地图瓦片组件
│   │   ├── item.rs          # 物品组件
│   │   └── building.rs      # 建筑组件
│   ├── systems/             # 游戏系统
│   │   ├── movement.rs      # 移动系统
│   │   ├── combat.rs        # 战斗系统
│   │   ├── ui.rs            # UI系统
│   │   ├── world_gen.rs     # 世界生成系统
│   │   └── resource_management.rs # 资源管理系统
│   ├── scenes/              # 游戏场景
│   │   ├── main_menu.rs     # 主菜单场景
│   │   ├── village.rs       # 村庄场景
│   │   ├── outside.rs       # 外部场景
│   │   ├── ship.rs          # 飞船场景
│   │   └── space.rs         # 太空场景
│   ├── utils/               # 工具函数
│   │   ├── math.rs          # 数学工具
│   │   └── serialization.rs # 序列化工具
│   └── events/              # 游戏事件
│       ├── combat_event.rs  # 战斗事件
│       └── resource_event.rs # 资源事件
└── assets/                  # 游戏资源
    ├── images/              # 图像资源
    ├── sounds/              # 音频资源
    └── fonts/               # 字体资源



## engine.js的逻辑
### Engine 核心功能总结

`Engine` 是 A Dark Room 游戏的核心引擎，负责统筹游戏的初始化、状态管理、用户交互和系统集成。以下是其主要功能模块的详细总结：

🔴待实现     🟠稍微可能实现   🟡最后再尝试实现  ❌拒绝实现的部分

#### **一、基础配置与初始化**
1. **版本与环境检测**
   - 定义游戏版本号 `VERSION: 1.3` 和基础配置（如最大存储值、自动保存间隔）
   - 检测浏览器兼容性和移动设备环境，不支持时跳转警告页面
   - 初始化游戏状态，加载本地存储或创建新游戏

2. **全局功能初始化**
   - 启动音频引擎、通知系统和事件系统   🔴
   - 初始化各游戏模块（房间、世界地图、飞船等）  🔴
   - 加载音乐和音效资源  🔴


#### **二、游戏状态管理**
1. **保存与加载机制**
   - `saveGame()`：将游戏状态保存到 localStorage❌
   - `loadGame()`：从 localStorage 加载游戏状态❌
   - 自动保存定时器和保存提示UI❌

2. **数据导出与导入**
   - 支持 Base64 编码导出游戏数据，便于备份和迁移❌
   - 提供导入功能，支持从剪贴板恢复游戏进度❌
   - 生成可分享的保存代码❌


#### **三、用户界面与交互**
1. **场景切换系统**
   - `travelTo(module)`：在房间、世界地图、飞船等场景间切换🟡
   - 动画效果：滑动切换场景，同步更新侧边栏位置🟡

2. **输入处理**
   - 键盘事件：方向键导航、功能键操作 🔴
   - 触摸滑动：支持移动端上下左右滑动操作 🟠
   - 输入锁定机制（`keyLock`）防止重复操作  🟡

3. **菜单与设置**
   - 语言切换：支持多语言界面动态更新 🟠
   - 灯光模式：切换亮/暗主题  🟡
   - 音量控制：静音/取消静音 🔴
   - 高速模式：将游戏速度翻倍  🟡


#### **四、游戏功能扩展**
1. **社交与分享**
   - 支持分享游戏到 Facebook、Twitter 等社交平台  🟠
   - 提供应用下载链接（iOS/Android）🟠

2. **游戏重置与进度管理**
   - 确认并删除游戏进度，支持保留声望数据
   - 事件统计与分析（通过 Google Analytics）

3. **特殊功能**
   - 灯光模式切换：动态加载暗色样式表
   - 音频上下文恢复：处理移动端音频权限限制


#### **五、事件系统与回调**
1. **自定义事件机制**
   - 通过 `$.Dispatch` 创建事件主题（topics）
   - 支持事件发布（publish）、订阅（subscribe）和取消订阅（unsubscribe）
   - 监听 `stateUpdate` 等全局事件

2. **回调处理**
   - 状态更新回调 `handleStateUpdates`
   - 模块切换时的回调处理
   - 资源变化时的UI更新


#### **六、工具函数与辅助功能**
1. **工具方法**
   - 生成GUID、检测元素可见性（`inView`）
   - 元素滚动控制（`scrollByX`）
   - 禁止/允许文本选择

2. **性能优化**
   - 高速模式（`doubleTime`）将定时器间隔减半
   - 按需加载资源，优化初始加载速度  🟡


#### **七、特权系统（Perks）**
定义游戏中的角色特权，影响游戏机制：
- 战斗特权：增加徒手/近战武器伤害  🟠
- 生存特权：减少食物/水消耗  🟠
- 探索特权：扩大视野、降低遭遇战概率  🟠
- 战斗特权：提高命中率、闪避率  🟠


### **核心设计特点**
1. **模块化架构**：统一管理各游戏模块的初始化和切换
2. **事件驱动**：通过自定义事件系统解耦组件间的依赖
3. **本地存储**：使用 localStorage 实现游戏状态持久化
4. **响应式交互**：同时支持键盘和触摸操作
5. **可配置性**：支持灯光、音效、速度等多项设置

该引擎通过上述功能实现了游戏的核心流程控制，确保各模块协同工作，为玩家提供完整的游戏体验。


## audio.js的逻辑
在bevy中再现。
背景音乐、🔴
事件音乐、🔴
音效的加载、播放与控制，🔴
淡入淡出的连续🟡
总音量控制🔴
淡入淡出时间🟠
处理音频上下文被挂起的情况（如移动端需要用户交互后才能播放音频）🟡
提供主音量和背景音乐音量的独立控制🟡
优先级控制：事件音乐播放时自动降低背景音乐音量🟡
错误处理：音频加载失败时提供默认提示音🟠
资源管理：正确释放不再使用的音频资源🟡